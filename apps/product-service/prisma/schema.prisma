// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("PRODUCT_MS_DATABASE_URL")
}

model ProductBase {
  id       String         @id @default(auto()) @map("_id") @db.ObjectId
  name     String
  category Category
  offers   ProductOffer[]

  @@map("product_bases")
}

model ProductOffer {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  productBaseId String      @db.ObjectId
  productBase   ProductBase @relation(fields: [productBaseId], references: [id])
  producerId    String
  name          String
  description   String
  price         Float
  isAvailable   Boolean     @default(true)
  imageUrl      String

  unitId        String      @db.ObjectId
  unit          Unit        @relation(fields: [unitId], references: [id])

  quantity      Float
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([productBaseId])
  @@index([producerId])
  @@index([unitId])
  @@map("product_offers")
}

model Unit {
  id              String     @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  symbol          String
  type            MeasureType
  description     String?
  equivalentValue Float?
  baseUnit        String?
  
  offers          ProductOffer[]

  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@map("units")
}


enum Category {
  FRUTAS
  VERDURAS
  GRANOS
  LEGUMINOSAS
  TUBERCULOS
  HIERBAS
  ESPECIAS
  SEMILLAS
  NUECES
  ACEITES
  LACTEOS
  CARNES
  AVES
  HUEVOS
  PESCADOS
  MIEL
  CAFE
  CACAO
  FLORES
  PLANTAS
  COMPOSTA
  FERTILIZANTES
  ALIMENTO_ANIMAL
  BEBIDAS
  PROCESADOS
}

enum MeasureType {
  WEIGHT    // (PESO) kg, g, lb, oz
  VOLUME    // (VOLUMEN) l, ml
  COUNT     // (CANTIDAD) unidad, docena
  LENGTH    // (LONGITUD) m, cm
  AREA      // (ÁREA) m², ha
  OTHER     // (OTRO)
}